<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Preguntas Preuniversitarias</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- KaTeX para renderizar matem√°ticas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Banco de Preguntas Preuniversitarias</h1>
            <p>Generador de preguntas en formato JSON</p>
        </header>

        <main>
            <form id="preguntaForm" enctype="multipart/form-data">
                
                <!-- SECCI√ìN 1: CAPTURA CON IA -->
                <div class="form-section ai-capture">
                    <h2>üöÄ 1. Procesar Pregunta con IA</h2>
                    <p>Sube una imagen de la pregunta del libro y la IA completar√° autom√°ticamente todos los campos</p>
                    
                    <div class="ai-upload-simple">
                        <div class="drag-drop-area" id="dragDropArea">
                            <div class="drag-drop-content">
                                <div class="drag-icon">üì∑</div>
                                <h3>Arrastra la imagen de la pregunta aqu√≠</h3>
                                <p>o haz clic para seleccionar</p>
                                <p style="font-size: 0.9em; color: #6c757d; margin-top: 5px;">
                                    <strong>üìã O haz clic aqu√≠ y presiona Ctrl+V</strong>
                                </p>
                                <input type="file" id="aiImageUpload" accept="image/*" hidden>
                                <button type="button" onclick="document.getElementById('aiImageUpload').click(); this.blur();" class="upload-btn">
                                    üìÅ Seleccionar Imagen
                                </button>
                            </div>
                        </div>
                        
                        <div class="ai-process-section">
                            <select id="aiService" name="aiService" class="ai-select">
                                <option value="gemini">ü§ñ Google Gemini Pro Vision</option>
                                <option value="openai">OpenAI GPT-4 Vision</option>
                                <option value="claude">Anthropic Claude Vision</option>
                                <option value="azure">Azure OpenAI Vision</option>
                            </select>
                            
                            <button type="button" id="processWithAI" class="ai-process-btn" disabled>
                                <span class="ai-btn-text">ü§ñ Procesar con IA</span>
                                <span class="ai-btn-loader" style="display: none;">
                                    <div class="spinner"></div>
                                    Procesando...
                                </span>
                            </button>
                        </div>
                        
                        <div id="aiPreview" class="ai-preview" style="display: none;">
                            <img id="aiPreviewImage" alt="Vista previa" />
                        </div>
                        
                        <div id="aiResults" class="ai-results" style="display: none;">
                            <h4>‚ú® IA complet√≥ el formulario - Revisa y edita si es necesario</h4>
                            <div class="ai-confidence">
                                <span>Confianza: <span id="aiConfidence">--</span>%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 2: CAMPOS B√ÅSICOS -->
                <div class="form-section basic-fields">
                    <h2>üìù 2. Informaci√≥n B√°sica</h2>

                    <div class="basic-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="tipo_clasificacion">Clasificaci√≥n:</label>
                            <select id="tipo_clasificacion" name="tipo_clasificacion" required>
                                <option value="">¬øC√≥mo clasificar esta pregunta?</option>
                                <option value="normal">üìö Distribuci√≥n normal (sin proceso espec√≠fico)</option>
                                <option value="proceso">üéØ Por proceso de admisi√≥n</option>
                            </select>
                        </div>
                    </div>

                    <!-- Secci√≥n de proceso (oculta por defecto) -->
                    <div id="proceso_section" style="display: none; margin-top: 20px;">
                        <h3 style="color: #4a90e2; margin-bottom: 15px;">Informaci√≥n del Proceso</h3>
                        <div class="basic-grid">
                            <div class="form-group">
                                <label for="area_academica">√Årea Acad√©mica:</label>
                                <select id="area_academica" name="area_academica">
                                    <option value="">Selecciona √°rea</option>
                                    <option value="ingenierias">Ingenier√≠as</option>
                                    <option value="biomedicas">Biom√©dicas</option>
                                    <option value="sociales">Sociales</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="anio">A√±o:</label>
                                <select id="anio" name="anio">
                                    <option value="">Selecciona a√±o</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="tipo_proceso">Tipo de Proceso:</label>
                                <select id="tipo_proceso" name="tipo_proceso">
                                    <option value="">Selecciona tipo</option>
                                    <option value="extraordinario">Extraordinario</option>
                                    <option value="ceprunsa">CEPRUNSA</option>
                                    <option value="ceprequintos">CEPREQUINTOS</option>
                                    <option value="ordinario">Ordinario</option>
                                </select>
                            </div>

                            <div class="form-group" id="fase_container" style="display: none;">
                                <label for="fase">Fase:</label>
                                <select id="fase" name="fase">
                                    <option value="">Selecciona fase</option>
                                </select>
                            </div>

                            <div class="form-group" id="examen_container" style="display: none;">
                                <label for="examen">Examen:</label>
                                <select id="examen" name="examen">
                                    <option value="">Selecciona examen</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="basic-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="materia">Materia:</label>
                            <select id="materia" name="materia" required>
                                <option value="">Selecciona materia</option>
                                {% for materia in materias %}
                                <option value="{{ materia }}">{{ materia }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tema">Tema:</label>
                            <input type="text" id="tema" name="tema" required
                                   placeholder="Ej: Ecuaciones Lineales">
                        </div>

                        <div class="form-group">
                            <label for="dificultad">Dificultad:</label>
                            <select id="dificultad" name="dificultad" required>
                                <option value="">Dificultad</option>
                                <option value="1">1 - Muy F√°cil</option>
                                <option value="2">2 - F√°cil</option>
                                <option value="3">3 - Intermedio</option>
                                <option value="4">4 - Dif√≠cil</option>
                                <option value="5">5 - Muy Dif√≠cil</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 3: PREGUNTA Y ALTERNATIVAS -->
                <div class="form-section question-section">
                    <h2>‚ùì 3. Pregunta y Alternativas</h2>
                    
                    <div class="form-group">
                        <label for="pregunta">Pregunta:</label>
                        <textarea id="pregunta" name="pregunta" rows="3" required 
                                  placeholder="Escribe la pregunta aqu√≠..."></textarea>
                        
                        <!-- Gu√≠a LaTeX compacta -->
                        <div class="latex-guide">
                            <div class="latex-header" onclick="toggleLatexGuide()">
                                <small>üí° <strong>Gu√≠a LaTeX (clic para ver ejemplos)</strong> ‚ñº</small>
                            </div>
                            <div class="latex-examples" id="latexExamples" style="display: none;">
                                <div class="examples-grid">
                                    <span><code>$$x^2$$</code> ‚Üí x¬≤</span>
                                    <span><code>$$\frac{a}{b}$$</code> ‚Üí a/b</span>
                                    <span><code>$$\sqrt{x}$$</code> ‚Üí ‚àöx</span>
                                    <span><code>$$x^{n+1}$$</code> ‚Üí x^(n+1)</span>
                                    <span><code>$$\sin \theta$$</code> ‚Üí sin Œ∏</span>
                                    <span><code>$$\leq$$</code> ‚Üí ‚â§</span>
                                    <span><code>$$\geq$$</code> ‚Üí ‚â•</span>
                                    <span><code>$$\pi$$</code> ‚Üí œÄ</span>
                                    <span><code>$$\alpha$$</code> ‚Üí Œ±</span>
                                    <span><code>$$\log_2 x$$</code> ‚Üí log‚ÇÇx</span>
                                </div>
                            </div>
                        </div>
                        <div id="pregunta-preview" class="math-preview"></div>
                    </div>

                    <div class="alternatives-section">
                        <h4>Alternativas:</h4>
                        <div class="alternatives-grid">
                            <div class="alternative">
                                <label>A)</label>
                                <textarea id="opcion_a" name="opcion_a" rows="2" required placeholder="Alternativa A"></textarea>
                                <div id="opcion_a-preview" class="math-preview-small"></div>
                            </div>
                            <div class="alternative">
                                <label>B)</label>
                                <textarea id="opcion_b" name="opcion_b" rows="2" required placeholder="Alternativa B"></textarea>
                                <div id="opcion_b-preview" class="math-preview-small"></div>
                            </div>
                            <div class="alternative">
                                <label>C)</label>
                                <textarea id="opcion_c" name="opcion_c" rows="2" required placeholder="Alternativa C"></textarea>
                                <div id="opcion_c-preview" class="math-preview-small"></div>
                            </div>
                            <div class="alternative">
                                <label>D)</label>
                                <textarea id="opcion_d" name="opcion_d" rows="2" required placeholder="Alternativa D"></textarea>
                                <div id="opcion_d-preview" class="math-preview-small"></div>
                            </div>
                            <div class="alternative">
                                <label>E)</label>
                                <textarea id="opcion_e" name="opcion_e" rows="2" required placeholder="Alternativa E"></textarea>
                                <div id="opcion_e-preview" class="math-preview-small"></div>
                            </div>
                        </div>
                        
                        <div class="correct-answer">
                            <label for="respuesta_correcta">Respuesta Correcta:</label>
                            <select id="respuesta_correcta" name="respuesta_correcta" required>
                                <option value="">Selecciona</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="explicacion">Explicaci√≥n:</label>
                        <textarea id="explicacion" name="explicacion" rows="3" required 
                                  placeholder="Explica por qu√© es correcta esta respuesta..."></textarea>
                        <div id="explicacion-preview" class="math-preview"></div>
                        
                        <!-- Secci√≥n opcional para generar explicaci√≥n con IA -->
                        <div class="explanation-ai-section">
                            <div class="ai-toggle" onclick="toggleExplanationAI()">
                                <input type="checkbox" id="useAIExplanation">
                                <label for="useAIExplanation">
                                    ü§ñ <strong>Generar explicaci√≥n autom√°ticamente con IA</strong>
                                    <small>Usa la imagen de la pregunta o sube im√°genes de soluci√≥n</small>
                                </label>
                            </div>

                            <div class="ai-explanation-upload" id="aiExplanationUpload" style="display: none;">
                                <!-- Selector de modo de generaci√≥n -->
                                <div class="explanation-mode-selector" style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Modo de generaci√≥n:</label>
                                    <div style="display: flex; gap: 15px;">
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="radio" name="explanation_mode" value="from_question" id="modeFromQuestion" checked>
                                            <span style="margin-left: 8px;">üì∑ Desde imagen de pregunta</span>
                                        </label>
                                        <label style="display: flex; align-items: center; cursor: pointer;">
                                            <input type="radio" name="explanation_mode" value="from_solution" id="modeFromSolution">
                                            <span style="margin-left: 8px;">üì∏ Desde im√°genes de soluci√≥n</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Secci√≥n de im√°genes de soluci√≥n (oculta por defecto) -->
                                <div class="solution-images-section" id="solutionImagesSection" style="display: none;">
                                    <h5>üì∏ Im√°genes de la Soluci√≥n (2-3 m√°ximo)</h5>
                                    <div class="solution-upload-grid">
                                        <div class="solution-upload-item">
                                            <div class="solution-drop-area" onclick="document.getElementById('solutionImage1').click()">
                                                <span class="upload-icon">üìÑ</span>
                                                <span>Imagen 1</span>
                                                <input type="file" id="solutionImage1" accept="image/*" hidden>
                                            </div>
                                            <div class="solution-preview" id="solutionPreview1" style="display: none;"></div>
                                        </div>

                                        <div class="solution-upload-item">
                                            <div class="solution-drop-area" onclick="document.getElementById('solutionImage2').click()">
                                                <span class="upload-icon">üìÑ</span>
                                                <span>Imagen 2</span>
                                                <input type="file" id="solutionImage2" accept="image/*" hidden>
                                            </div>
                                            <div class="solution-preview" id="solutionPreview2" style="display: none;"></div>
                                        </div>

                                        <div class="solution-upload-item">
                                            <div class="solution-drop-area" onclick="document.getElementById('solutionImage3').click()">
                                                <span class="upload-icon">üìÑ</span>
                                                <span>Imagen 3</span>
                                                <input type="file" id="solutionImage3" accept="image/*" hidden>
                                            </div>
                                            <div class="solution-preview" id="solutionPreview3" style="display: none;"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="generate-explanation-section">
                                    <button type="button" id="generateExplanation" class="generate-explanation-btn">
                                        <span class="gen-btn-text">‚ú® Generar Explicaci√≥n con IA</span>
                                        <span class="gen-btn-loader" style="display: none;">
                                            <div class="spinner"></div>
                                            Procesando...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN 4: IMAGEN MANUAL (OPCIONAL) -->
                <div class="form-section image-section">
                    <h2>üñºÔ∏è 4. Imagen Final (Opcional)</h2>
                    <p>Sube aqu√≠ la imagen editada en Adobe Illustrator o deja vac√≠o si no tiene imagen</p>

                    <div class="form-group">
                        <label for="imagen">Imagen procesada:</label>
                        <div class="final-image-drop-area" id="finalImageDropArea" style="border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; margin-bottom: 10px; cursor: pointer;">
                            <p style="margin: 10px 0;">üìé Arrastra la imagen aqu√≠, haz clic para seleccionar o <strong>presiona Ctrl+V para pegar</strong></p>
                            <input type="file" id="imagen" name="imagen" accept="image/*" hidden>
                            <button type="button" onclick="document.getElementById('imagen').click(); this.blur();" style="padding: 8px 16px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üìÅ Seleccionar Imagen
                            </button>
                        </div>
                        <div id="finalImagePreview" style="display: none; margin-top: 10px;">
                            <img id="finalImagePreviewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #e9ecef;" alt="Vista previa">
                        </div>
                        <small>Formatos: JPG, PNG, GIF, BMP, WebP | M√°ximo 5MB</small>
                    </div>
                </div>

                <!-- BOTONES Y ACCIONES -->
                <div class="form-actions">
                    <button type="submit" id="submitBtn" class="submit-btn">
                        <span class="btn-text">‚úÖ Crear Pregunta JSON</span>
                        <span class="btn-loader" style="display: none;">
                            <div class="spinner"></div>
                            Procesando...
                        </span>
                    </button>
                    <button type="reset" id="resetBtn" class="reset-btn">üîÑ Limpiar Todo</button>
                </div>
            </form>

            <!-- Mensajes y resultados -->
            <div id="mensaje" class="mensaje" style="display: none;"></div>
            
            <div id="jsonPreview" class="json-preview" style="display: none;">
                <h3>üìÑ JSON Generado:</h3>
                <pre id="jsonContent"></pre>
                <button type="button" onclick="copyToClipboard(document.getElementById('jsonContent').textContent)" class="copy-btn">
                    üìã Copiar JSON
                </button>
            </div>
        </main>
    </div>

    <script src="/static/js/script.js"></script>
</body>
</html>